<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

	<meta content="text/html;charset=UTF-8"/>
	<!-- 让360浏览器默认选择webkit内核 -->
	<meta name="renderer" content="webkit"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- 告诉浏览器响应屏幕宽度 -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

	<title>登录页面</title>
	<link rel="stylesheet" th:href="@{/login/bootstrap.min.css}" />
	<link rel="stylesheet" th:href="@{/login/css/camera.css}" />
	<link rel="stylesheet" th:href="@{/login/bootstrap-responsive.min.css}" />
	<link rel="stylesheet" th:href="@{/login/matrix-login.css}" />
	<link rel="stylesheet" th:href="@{/login/font-awesome.css}" />

	
	<!-- 软键盘控件start -->
	<link th:href="@{/login/keypad/css/framework/form.css}" rel="stylesheet" type="text/css"/>

	<style type="text/css">
		/*
       body{
        -webkit-transform: rotate(-3deg);
        -moz-transform: rotate(-3deg);
        -o-transform: rotate(-3deg);
        padding-top:20px;
        }
        */
		.cavs{
			z-index:1;
			position: fixed;
			width:95%;
			margin-left: 20px;
			margin-right: 20px;
		}
	</style>


</head>
<body>
	
	<div style="display: none">
	    <audio th:src="@{/login/music/fh1.mp3}" autoplay=""></audio>
	</div>
	
	<canvas class="cavs"></canvas>

	<div style="width:100%;text-align: center;margin: 0 auto;position: absolute;">
		<!-- 登录 -->
		<div id="windows1">
			<div id="loginbox" >
				<form onsubmit="return false;" method="post" id="loginForm">
					<div class="control-group normal_text">
						<h3>
							<img th:src="@{/login/logo.png}" alt="Logo" />
						</h3>
					</div>

					<div class="control-group">
						<div class="controls">
							<div class="main_input_box">
								<span class="add-on bg_lg">
								<i><img height="37" th:src="@{/login/user.png}" /></i>
								</span><input type="text" name="loginName" id="loginName" autocomplete="off" placeholder="请输入用户名" />
							</div>
						</div>
					</div>

					<div class="control-group">
						<div class="controls">
							<div class="main_input_box">
								<span class="add-on bg_ly">
								<i><img height="37" th:src="@{/login/suo.png}" /></i>
								</span><input type="password" name="loginPassword" id="loginPassword"  autocomplete="off"
									   placeholder="请输入密码" class="keypad"  keypadMode="full" allowKeyboard="true" />
							</div>
						</div>
					</div>





					<div class="control-group">
						<div class="controls">
							<div class="main_input_box" style="display: inline">
								<span class="add-on bg_ly">
								<i><img height="37" th:src="@{/login/yan.png}" /></i>
								</span><input type="text" name="validateCode" id="validateCode" class="login_code"
										   style="width: 50%" autocomplete="off"  />
									<i>
										<img style="height:22px;" id="codeImg" th:src="@{/login/captcha(type=math)}" />
									</i>


							</div>
						</div>
					</div>



					<div class="form-actions">
						<div class="controls" style="display: inline">

							<input class="form-field-checkbox"   style="padding-top:0px;"
								   id="rememberMe" name="rememberMe"  type="checkbox"/>

								<font color="white">记住密码</font>


							<span class="pull-right" style="padding-right:3%;">
								<a href="javascript:register();" class="btn btn-success">注册</a>
							</span>

							<span class="pull-right">
								<a onclick="loginForm();" class="flip-link btn btn-info" id="loginBtn">登录</a>
							</span>
						</div>
					</div>



				</form>
				<div class="controls">
					<div class="main_input_box">
						<font color="white"><span id="nameerr">Copyright © fcqq87766867 2100</span></font>
					</div>
				</div>
			</div>
		</div>
	</div>


	<div id="templatemo_banner_slide" class="container_wapper">

		<div class="camera_wrap camera_emboss" id="camera_slide">
			<!-- 背景图片 -->
			<div th:data-src="@{/login/images/banner_slide_01.jpg}"></div>
			<div th:data-src="@{/login/images/banner_slide_02.jpg}"></div>
			<div th:data-src="@{/login/images/banner_slide_03.jpg}"></div>
			<div th:data-src="@{/login/images/banner_slide_04.jpg}"></div>
			<div th:data-src="@{/login/images/banner_slide_05.jpg}"></div>
		</div>
	</div>



	<script type="text/javascript" th:src="@{/login/js/jquery-1.7.2.js}"></script>
	<script type="text/javascript" th:src="@{/login/js/bootstrap.min.js}"></script>
	<script type="text/javascript" th:src="@{/login/js/jquery.easing.1.3.js}"></script>
	<script type="text/javascript" th:src="@{/login/js/jquery.mobile.customized.min.js}"></script>
	<script type="text/javascript" th:src="@{/login/js/camera.min.js}"></script>
	<script type="text/javascript" th:src="@{/login/js/templatemo_script.js}"></script>
	<script type="text/javascript" th:src="@{/login/js/ban.js}"></script>
	<script type="text/javascript" th:src="@{/login/js/jQuery.md5.js}"></script>
	<script type="text/javascript" th:src="@{/login/js/jquery.tips.js}"></script>
	<script type="text/javascript" th:src="@{/login/js/jquery.cookie.js}"></script>


	<script type="text/javascript" th:src="@{/project/js/common-constant.js}"></script>
	<script type="text/javascript" th:src="@{/project/js/common-tool.js}"></script>
	
	<!-- 软键盘控件start -->
	<script type="text/javascript" th:src="@{/login/keypad/js/form/keypad.js}"></script>
	<script type="text/javascript" th:src="@{/login/keypad/js/framework.js}"></script>
	<!-- 软键盘控件end -->



	<script type="text/javascript" th:inline="javascript">



		//session获取iframe处理
		$(function () {
			//判断当前是否为顶层，如果不是，则顶层页面重定向到当前页面
			if (window != top) {
				top.location.href = location.href;
			}
		});



		var isProcessing = false;
		var context = [[@{/}]];
		var ctx = context ;

		var message = "[[${message}]]";
		if (message != undefined && message != null && message != "null" && message != "") {
			alert(message);
		}


		<!--  验证码 -->
		$('#codeImg').click(function () {
			var url = context + "/login/captcha?type=math&s=" + Math.random();
			$("#codeImg").attr("src", url);
		});


		function loginForm() {

			if (isProcessing) {
				return false;
			}


			//定义登录请求参数
			var params = {};
			// 有效性校验
			var field = $('input[name="loginName"]');
			if (0 == jQuery.trim(field.val()).length) {
				showMessage('请输入“账号”！');
				field.focus();

				return false;
			}
			//登录请求参数中定义用户名及设置value
			params.loginName = $('input[name="loginName"]').val();


			field = $('input[name="loginPassword"]');
			if (0 == jQuery.trim(field.val()).length) {
				showMessage('请输入“密码”！');
				field.focus();

				return false;
			}
			//登录请求参数中定义密码及设置value
			params.loginPassword = $('input[name="loginPassword"]').val();

			if ('0' == '1') {
				field = $('input[name="code"]');
				if (0 == jQuery.trim(field.val()).length) {
					showMessage('请输入“验证码”！');
					field.focus();

					return false;
				} else if (5 != field.val().length) {
					showMessage('请输入5位“验证码”！');
					field.focus();

					return false;
				}
				//登录请求参数中定义验证码及设置value
				params.code = $('input[name="code"]').val()
			}
			// 登录处理
			isProcessing = true;
			$('#btnLogin').text('登录中......').prop('disabled', 'true');

			var url = ctx + 'login/login';


			syncPost(url, params, function (rsp, textStatus, jqXHR) {
				if (rsp.success) {
					$.cookie('loginName', $('input[name="loginName"]').val(), {expires: 365});

					window.location.href = ctx +'main/home';
				} else {
					if ('0' == '1') {
						refreshCode();
					}
					isProcessing = false;
					$('#btnLogin').text('登录').prop('disabled', '');

					showMessage(rsp.msg);
				}
			}, function () {

				isProcessing = false;
				$('#btnLogin').text('登录').prop('disabled', '');

				showMessage("请求服务出现错误,请重试");
			});

			return false;
		}


		/**
		 * 显示登录错误信息
		 */
		function showMessage(msg)
		{
			$('#divMsg').html('<i class="icon icon-volume-down" style="font-size: 20px; vertical-align: bottom;"></i>&nbsp;' + msg)
					.show()
					.stop(true).fadeOut(500).fadeIn(500).fadeOut(500).fadeIn(500);
		}


	</script>
</body>
</html>